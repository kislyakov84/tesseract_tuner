```markdown
# Tesseract OCR Preprocessing Tuner

Этот инструмент помогает найти оптимальные параметры предобработки изображений перед их передачей в Tesseract OCR, специально разработанный для распространенных случаев использования, таких как извлечение текста из скриншотов приложений (например, интерфейсов букмекерских контор). Он перебирает различные комбинации масштабирования изображения, регулировки контраста, резкости, адаптивной бинаризации и размытия, оценивая результаты OCR по известному целевому тексту.

## Возможности

-   **Автоматическая настройка параметров:** Находит оптимальные `scale_factor`, `contrast_enhance`, `sharpness_enhance`, `adaptive_method`, `adaptive_block_size`, `adaptive_C` и `median_blur_kernel` для вашего типа изображения.
-   **Оптимизация на основе оценки:** Использует механизм оценки для определения точности OCR, особенно для сложных паттернов, таких как форы и коэффициенты.
-   **Простой в использовании:** Интерфейс командной строки для быстрого выполнения.
-   **Автономный:** Единый скрипт Python с минимальными зависимостями.

## Предварительные требования

Прежде чем начать, убедитесь, что у вас установлено следующее:

1.  **Python 3.x**:
    Загрузите с [python.org](https://www.python.org/downloads/).
2.  **Движок Tesseract OCR**:
    Этот инструмент *требует* установки Tesseract на вашей системе.
    -   **Windows**: Загрузите установщик с [Tesseract at UB Mannheim](https://digi.bib.uni-mannheim.de/tesseract/). Не забудьте добавить Tesseract в системную переменную PATH во время установки или укажите путь к нему с помощью аргумента `--tesseract_path`.
    -   **macOS**: `brew install tesseract` (если у вас установлен Homebrew).
    -   **Linux (Debian/Ubuntu)**: `sudo apt install tesseract-ocr`
    -   Для других систем обратитесь к [документации Tesseract](https://tesseract-ocr.github.io/tessdoc/Installation.html).

## Установка

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/kislyakov84/tesseract_tuner.git
    cd tesseract_tuner
    ```

2.  **Установите зависимости Python:**
    ```bash
    pip install -r requirements.txt
    ```

## Использование

Запустите тюнер из терминала, указав путь к эталонному изображению и точный текст, который вы ожидаете найти на этом изображении.

```bash
python tesseract_tuner.py <path_to_your_image.png> "<Ваш Целевой Текст>" [опции]
```

**Аргументы:**

-   `<path_to_your_image.png>`: **Обязательный**. Путь к файлу изображения (например, скриншоту), содержащему текст, для которого вы хотите оптимизировать OCR.
-   `<Ваш Целевой Текст>`: **Обязательный**. Точная текстовая строка, которую вы ожидаете найти на изображении. Этот текст используется для оценки результатов OCR. **Заключите в двойные кавычки, если текст содержит пробелы.**
    -   **Важно для случаев использования в спортивных ставках**: Включайте значения форы в скобках (например, `(+1.0)`) и, если применимо, числовой коэффициент в самом конце (например, `1.097`).
    -   **Примеры**:
        -   `"Форы Победа с учетом форы Реймс (+1.0) 1.097"`
        -   `"Мальме (-0.5) 1.45"`
        -   `"Some general text 1.23"`

**Опции:**

-   `--max_combinations <number>`: Максимальное количество комбинаций параметров для проверки. По умолчанию `5000`. Меньшие значения для более быстрого, но менее полного поиска.
-   `--verbose`: Включить отладочное логирование для более подробного вывода во время процесса настройки.
-   `--tesseract_path <path>`: Необязательный путь к исполняемому файлу Tesseract. Используйте это, если Tesseract не находится в системной переменной PATH.

### Примеры:

1.  **Базовая настройка:**
    ```bash
    python tesseract_tuner.py sample_image.png "Форы Победа с учетом форы Реймс (+1.0) 1.097"
    ```

2.  **С увеличенной детализацией и ограниченным количеством комбинаций:**
    ```bash
    python tesseract_tuner.py my_screenshot.png "Team A - Team B, 1.5 goals total (over) 1.85" --max_combinations 1000 --verbose
    ```

3.  **Указание пути к Tesseract (пример для Windows):**
    ```bash
    python tesseract_tuner.py C:\Users\User\Desktop\game_screenshot.png "Player Name (2.5) 2.10" --tesseract_path "C:\Program Files\Tesseract-OCR\tesseract.exe"
    ```

## Вывод

По завершении работы скрипт выведет "Рекомендуемые параметры предобработки Tesseract" в консоль. Это параметры, которые привели к наивысшему результату OCR для вашего целевого текста на предоставленном изображении, а также достигнутый балл. Затем вы можете интегрировать эти параметры в своего основного бота или приложение.

## Как это работает (Кратко)

Тюнер выполняет следующие шаги:
1.  **Предварительная обработка изображения**: Применяет различные преобразования (масштабирование, контрастность, резкость, адаптивную бинаризацию, размытие) к входному изображению.
2.  **Выполнение OCR**: Запускает Tesseract OCR на предварительно обработанном изображении.
3.  **Оценка**: Оценивает вывод OCR по вашему `target_text`. Функция оценки специально ищет наличие отображения форы (например, `(+1.0)`) и значения коэффициента, присваивая более высокие баллы за совпадения и высокую уверенность OCR.
4.  **Оптимизация**: Перебирает предопределенный диапазон параметров предобработки, отслеживая комбинацию, которая дает наивысший балл OCR.

## Вклад

Не стесняйтесь открывать issues или отправлять pull requests, если у вас есть предложения по улучшению или исправлению ошибок.

## Лицензия

Этот проект распространяется под лицензией MIT — подробности см. в файле `LICENSE`.
```